#coding=utf-8
'''
Created on 2016年3月4日

@author: admin
'''
from fabric.api import *
from fabric.contrib.console import confirm

#env.user="root"
env.host_string='root@121.40.164.251:22'
env.password='JiaDe~!234'

def getfile(localpath,remotepath):
    with settings(warn_only=True):
        result=get(remotepath,localpath)
    if result.failed and not confirm("get file failed,continue[Y/N]"):
        abort("Aborting file get task!")
def putfile(localpath,remotepath):
    with settings(warn_only=True):
        result=put(localpath,remotepath)
    if result.failed and not confirm("get file failed,continue[Y/N]"):
        abort("Aborting file get task!")
    else:
        print "put file ok!"    
def check_file(localpath,remotepath):
    with settings(warn_only=True):
        lmd5=local("certutil -hashfile %s MD5" % localpath,capture=True).split("\r\n")[1].replace(' ','')
        rmd5=run("md5sum %s" % remotepath).split(' ')[0]
        print "lmd5_value:%s" % lmd5
        print "Rmd5_value:%s" % rmd5
    if lmd5==rmd5:
        print "check over"
    else:
        print "check fail"
if __name__=="__main__":
    import readfile as f
    fabdict=dict(f.readfile("fabtest.csv"))
    localpath=fabdict['localpath']
    remotepath=fabdict['remotepath']
    getfile(localpath,remotepath)
    check_file(localpath,remotepath)
    #print fabdict
    
    #putfile(localpath, remotepath)

    
